function MyListingsPage(){var vci_markup='<div class="col-xs-12 nopadding"> <div class="col-sm-4 col-xs-12" style="padding-top:5px;"> <i class="icon-cf icon-cf-warning" style="color:red;"></i> Is this requirement by an Agent? <span><a href="javascript:void(0);" class="custom-link report-agent" lead_id="{lead_id}">Report</a></span> </div> <div class="col-sm-4 text-right col-xs-12"> <i class="icon-cf icon-cf-mail"></i>{email}</div> <div class="col-sm-4 text-right col-xs-12"> <div class="pull-right"><div><i class=""></i><small>{contact_time}</small></div> <div>{mobile}</div></div><i class="icon-cf icon-cf-mobile pull-right" style=" "></i> </div> </div>';this.init=function(){try{var page=$("[sub-page-name]").attr("sub-page-name");switch(page){case"mylistings-page":bindMyListingsHandlers();break;case"mylistings-details-page":bindMyListingsDetailsEvents();break;default:break}}catch(e){console.error("Error intializing My Listings Page :: "+e.message)}};function bindMyListingsDetailsEvents(){$('[data-toggle="tooltip"]').tooltip({placement:"bottom"});$("#listings-detail-carousel").on("slid.bs.carousel",function(e){var index=$("#listings-detail-carousel .carousel-inner .active").index()+1;$("#listings-detail-carousel .carousel-control .custom-sr .n").text(index)});$("#listings-tabbed-bar a[data-type]").click(function(){$("#listings-tabbed-bar a[data-type]").removeClass("active");var type=$(this).addClass("active").attr("data-type");if(type==="response"){$("#suggested-requirements").hide()}else{if(type==="suggested_response"){$("#suggested-requirements").show()}}$("#mylistings-details-page .table-responsive .tabbed-tables").hide();$("#"+type+"_table").show()});$(".page-mylistings-details .play-pause-toggle").click(function(){var listing_id=$("#listing_id").attr("listing_id");var _this=$(this);if(_this.hasClass("disabled")){return}var is_paused;var url;if(_this.hasClass("pause-btn")){url="/agent/property-listing/pause-listings";is_paused=false}else{if(_this.hasClass("unpause-btn")){url="/agent/property-listing/unpause-listings";is_paused=true}else{return}}themeInteraction.postData(url,"listing_ids="+listing_id,function(response){var response_arr=response.split("|");if(response_arr[0]==0){showNotification(response_arr[1],"error")}else{if(response_arr[0]==1){var result=JSON.parse(response_arr[1]);if(result.hasOwnProperty(listing_id)){if(is_paused){showNotification("Listing unpaused successfully.");_this.find("a").text("Pause");_this.removeClass("unpause-btn").addClass("pause-btn");_this.find(".icon-cf-play").removeClass("icon-cf-play").addClass("icon-cf-pause")}else{showNotification("Listing paused successfully.");_this.find("a").text("Unpause");_this.removeClass("pause-btn").addClass("unpause-btn");_this.find(".icon-cf-pause").removeClass("icon-cf-pause").addClass("icon-cf-play")}}else{showNotification("Some error occured while pausing the listing. We are looking into it.","error")}}}})});$(".page-mylistings-details .edit-lead-cap-btn").click(function(){var _this=$(this);if(_this.hasClass("disabled")){return}$("#edit-lead-cap-modal").modal("show");$("#lead-cap").val("")});$("#edit-lc-submit").click(function(){var m=$("#edit-lead-cap-modal");var _this=$(this);var r=validateHtmlElements(m);if(r!==-1){var url="/realestate-agent/update-listing-level-cap";var listing_id=$("#listing_id").attr("listing_id");var lead_cap_val=$("#lead-cap").val();var data="listing_id="+listing_id+"&new_listing_cap="+lead_cap_val;m.modal("hide");themeInteraction.postData(url,data,function(response){var response_json=JSON.parse(response);if(response_json.status==1){$(".page-mylistings-details .edit-lead-cap-btn").find(".lead-cap-val").text(lead_cap_val);$("#edit-lead-cap-modal").find(".lead-cap-val").text(lead_cap_val)}showNotification(response_json.message)})}});var lead_id;var broker_id=$("#broker_id").val();var listing_id=$("#listing_id").attr("listing_id");var curEl;$(".vci-btn").click(function(){$("#vci-modal").modal("show");curEl=$(this);lead_id=$(this).attr("lead_id")});$("#vci-submit").click(function(){var p=curEl.hide().parent();p.append('<img src="/public/assets/agent/img/ajax-loader.gif"/>');var data="listing_id="+lead_id+"&listing_type=requirement&broker_id="+broker_id+"&shared_reason=suggested&li="+listing_id;themeInteraction.postData("/agent/property-listing/show-listing-contact-info-for-broker",data,function(response){if(response.indexOf("|")>-1){var msg=response.split("|")[1];showNotification(msg,"error");p.find("img").hide();return}try{response=JSON.parse(response);p.html(vci_markup.interpolate(response))}catch(e){}});lead_id=""});$("a.report-agent").die("click");$("a.report-agent").live("click",function(){var _this=$(this);var lead_id=_this.attr("lead_id");var data="broker_id="+broker_id+"&pool_id="+lead_id;var url="agent/report/raise-lead-refund-request";var p=_this.parent();p.html("<b>Reporting...</b>");themeInteraction.postData(url,data,function(response){p.html("<b>Reported</b>")})});$(".repost-btn").click(function(){var _this=$(this);if(_this.hasClass("disabled")){return}_this.find("span").text("Reposting...");var url="/agent/property-listing/refresh";var data="li[]="+listing_id+"&r=a";themeInteraction.postData(url,data,function(response){showNotification(response);themeInteraction.fetchPage("agent/property-listing/show-listing-details","listing_id="+listing_id)})});var leadId;$(".agent_lead_status").click(function(){var tr=$(this).closest("tr");leadId=tr.attr("id");var modal=$("#lead-status-modal").modal("show");var t=tr.find(".lead-status").text().trim();if(t!="Not Specified"){modal.find("select").val(t)}else{modal.find("select").val("")}});$("#lead-status-modal .add-status").click(function(){var tagValue=$("#lead-status-modal .lead-status option:selected").val();var d="tg="+tagValue+"&tt=status&li="+leadId;$("#lead-status-modal").modal("hide");themeInteraction.postData("/agent/report/add-tag",d,function(resp){var editField=$("#"+leadId);editField.find(".lead-status").find("span").text(tagValue);showNotification("Status is successfully updated")})});$(".agent_lead_remarks").click(function(){var tr=$(this).closest("tr");leadId=tr.attr("id");var t=tr.find(".lead-remark").text().trim();var modal=$("#lead-remarks-modal").modal("show");if(t!="Not Specified"){modal.find("textarea").val(t)}else{modal.find("textarea").val("")}});$("#lead-remarks-modal .add-remarks").click(function(){remarks=$("#lead-remarks-modal textarea.lead_remark_in").val();var d="tg="+remarks+"&tt=remark&li="+leadId;$("#lead-remarks-modal").modal("hide");themeInteraction.postData("/agent/report/add-tag",d,function(resp){var editField=$("#"+leadId);editField.find(".lead-remark").find("span").text(remarks);editField.find(".remarks-tooltip").attr("data-original-title",remarks);showNotification("Remark successfully added")})});var reportBtn;$(".report_button").click(function(){reportBtn=$(this);if(reportBtn.attr("report-broker")=="false"){return}$("#report-agent-modal").modal("show")});$("#report-agent-modal-submit").click(function(){var td=reportBtn.closest("td").html("Reporting...");var pool_id=reportBtn.attr("lead-id");var broker_id=reportBtn.attr("broker-id");var url="agent/report/raise-lead-refund-request";var data="broker_id="+broker_id+"&pool_id="+pool_id;themeInteraction.postData(url,data,function(){td.html("Reported")})})}function bindMyListingsHandlers(){$('[data-toggle="tooltip"]').tooltip();function applyFilters(dataparams){var listingsTabbedActiveBar=$("#listings-tabbed-bar a.active");var data=("lst[]="+listingsTabbedActiveBar.attr("data-status")||"")+"&asf=listing&asi="+$(".toggle-btn-grp>button.active").attr("data-intent")+"&"+(listingsTabbedActiveBar.attr("extra-params")||"")+"&"+(dataparams||"")+"&"+($("select[max-page-size]").serialize()||"");themeInteraction.fetchPage("/agent/property-listing/my-listings",data)}$(".toggle-btn-grp>button").click(function(){$(this).parent().children().removeClass("active");$(this).addClass("active");applyFilters()});$("#listings-tabbed-bar a[data-status]").click(function(){$(this).closest(".tabbed-bars").find("a").removeClass("active");$(this).removeClass("white-btn").addClass("active");applyFilters()});$("select[max-page-size]").change(function(){if(this.value==""){return false}applyFilters()});$(".pagination-container li a").click(function(){var _this=$(this);var pageNum=_this.attr("data-page");if(_this.parent().hasClass("disabled")){return}if(!pageNum){return}var data="plp="+(pageNum||"");data+="&"+document.getElementById("sort_params").value;data+="&"+$("select[credit-filter]").serialize()||"";applyFilters(data)});$("a[sort-title]").click(function(){var _this=$(this);var sortParams="so="+_this.attr("sort-title");if(_this.hasClass("table-sort-asc")){_this.removeClass("table-sort").removeClass("table-sort-asc").addClass("table-sort-desc");sortParams+="&sot=DESC"}else{_this.removeClass("table-sort").removeClass("table-sort-desc").addClass("table-sort-asc");sortParams+="&sot=ASC"}document.getElementById("sort_params").value=sortParams;var data="&"+sortParams;applyFilters(data)});$("tr[data-listing-id]").click(function(e){if(e.target.attributes.hasOwnProperty("pause-checkbox")){return}var listing_id=$(this).attr("data-listing-id");if(!listing_id){return}window.location.href="#/mylistings-detail?listing_id="+listing_id});$("#listings-table th input[pause-all-checkbox]").change(function(){if(this.checked){$("tr[data-listing-id] input[pause-checkbox]").each(function(){$("#pause-unpause-btn").removeAttr("disabled");this.checked=true})}else{$("tr[data-listing-id] input[pause-checkbox]").each(function(){$("#pause-unpause-btn").attr("disabled",true);this.checked=false})}});$("tr[data-listing-id] input[pause-checkbox]").change(function(){var checkedLength=$("#listings-table tbody input[pause-checkbox]:checked").length;$("#listings-table th input[pause-all-checkbox]")[0].checked=false;if(checkedLength==0){$("#pause-unpause-btn").attr("disabled",true)}else{$("#pause-unpause-btn").removeAttr("disabled")}});$("#pause-unpause-btn").click(function(){var _this=$(this);if(_this.attr("disabled")===undefined){var is_paused;var url;if(_this.hasClass("pause")){is_paused=false;url="/agent/property-listing/pause-listings"}else{if(_this.hasClass("unpause")){is_paused=true;url="/agent/property-listing/unpause-listings"}}var listing_ids=[];var current_index=0;$("#listings-table tr[data-listing-id]").each(function(index){var _this=$(this);var is_selected=_this.find("input").is(":checked");if(is_selected){listing_ids[current_index]=_this.attr("data-listing-id");current_index+=1}});themeInteraction.postData(url,{listing_ids:listing_ids},function(response){var response_arr=response.split("|");var type="success";if(response_arr[0]==0){showNotification(response_arr[1],"error")}else{if(response_arr[0]==1){var result=JSON.parse(response_arr[1]);var success=0,failure=0;for(var index=0;index<listing_ids.length;index++){if(result.hasOwnProperty(listing_ids[index])){if(!is_paused){success+=1}else{if(result[listing_ids[index]]==0){success+=1}else{failure+=1}}}else{failure+=1}}var success_text=" listing has ";var failure_text=" listing is ";if(success>1){success_text=" listings have "}if(failure>1){failure_text=" listings are ";type="error"}if(is_paused){var msg="";if(success>0){msg+="* "+success+success_text+"been unpaused successfully.\n"}if(failure>0){msg+="* "+failure+failure_text+"not unpaused due to either of two reasons - you may have reached the credit cap on this listing or may not have sufficient credit balance in your account.\nCall Agent Care for any further questions.";type="error"}showNotification(msg,type)}else{var msg="";if(success>0){msg+="* "+success+success_text+"been paused successfully.\n"}if(failure>0){msg+="* "+failure+failure_text+"not paused because of some error. We are looking into it.";type="error"}showNotification((success+success_text+"been paused successfully."),type)}applyFilters()}}})}})}};